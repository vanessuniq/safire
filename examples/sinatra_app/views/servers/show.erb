<div class="page-header">
  <h1><%= h(@server.name) %></h1>
  <div class="page-actions">
    <a href="/servers/<%= @server.id %>/edit" class="btn btn-secondary">Edit</a>
    <form action="/servers/<%= @server.id %>" method="post" class="inline-form"
          onsubmit="return confirm('Are you sure you want to delete this server?');">
      <input type="hidden" name="_method" value="delete">
      <button type="submit" class="btn btn-danger">Delete</button>
    </form>
  </div>
</div>

<section class="server-details">
  <h2>Server Configuration</h2>
  <dl class="details-list">
    <dt>Base URL</dt>
    <dd><code><%= h(@server.base_url) %></code></dd>

    <dt>Client ID</dt>
    <dd><code><%= h(@server.client_id) %></code></dd>

    <dt>Client Secret</dt>
    <dd><%= @server.confidential? ? '••••••••••••' : '<em>Not configured (public client)</em>' %></dd>

    <dt>Scopes</dt>
    <dd><%= @server.scopes.empty? ? '<em>None configured</em>' : h(@server.scopes_display) %></dd>

    <dt>Callback URL</dt>
    <dd><code><%= redirect_uri %></code></dd>
  </dl>
</section>

<section class="demo-actions">
  <h2>Demo Actions</h2>
  <p>Select an action to demonstrate Safire's SMART on FHIR capabilities:</p>

  <div class="action-cards">
    <div class="action-card">
      <h3>SMART Discovery</h3>
      <p>Fetch the server's SMART configuration from <code>/.well-known/smart-configuration</code></p>
      <a href="/demo/<%= @server.id %>/discovery" class="btn btn-primary">Run Discovery</a>
    </div>

    <div class="action-card">
      <h3>Authorization Flow</h3>
      <p>Start a SMART authorization flow to obtain access tokens.</p>
      <a href="/demo/<%= @server.id %>/authorize" class="btn btn-primary">Start Authorization</a>
    </div>

    <div class="action-card">
      <h3>Token Refresh</h3>
      <p>Test token refresh using a previously obtained refresh token.</p>
      <% if session[:refresh_token] && session[:token_server_id] == @server.id %>
        <a href="/demo/<%= @server.id %>/refresh" class="btn btn-primary">Refresh Token</a>
      <% elsif session[:access_token] && session[:token_server_id] == @server.id && session[:refresh_token].blank?%>
        <p class="disabled-note"><em>Server did not issue a refresh token during authorization. It may not support refresh tokens.</em></p>
      <% else %>
        <p class="disabled-note"><em>Complete authorization flow first to enable token refresh.</em></p>
      <% end %>
    </div>
  </div>
</section>

<div class="back-link">
  <a href="/">&larr; Back to Servers</a>
</div>
